generator client {
  provider = "prisma-client"
  output   = "../app/generated/prisma"
}

datasource db {
  provider = "postgresql"
}

// ─── Enums ───────────────────────────────────────────────────────────

enum Role {
  ADMIN
  STAFF
}

enum SetupStatus {
  PROPOSAL
  APPROVED
  ONGOING
  WITHDRAWN
  TERMINATED
  EVALUATED
  GRADUATED
}

enum DocumentPhase {
  INITIATION
  IMPLEMENTATION
}

enum MapProgram {
  SETUP
  CEST
  SSCP
  LGIA
}

// ─── User ────────────────────────────────────────────────────────────

model User {
  id           String    @id @default(uuid()) @db.Uuid
  email        String    @unique
  passwordHash String
  fullName     String
  contactNo    String?
  birthday     DateTime? @db.Date
  role              Role      @default(STAFF)
  profileImageUrl   String?
  resetOtp          String?
  resetOtpExpiresAt DateTime?
  createdAt         DateTime  @default(now())
  updatedAt         DateTime  @updatedAt

  @@map("users")
}

// ─── SETUP Projects ──────────────────────────────────────────────────

model SetupProject {
  id              String      @id @default(uuid()) @db.Uuid
  code            String      @unique
  title           String
  firm            String?
  typeOfFirm      String?
  address         String?
  coordinates     String?
  corporatorName  String?
  contactNumbers  String[]
  emails          String[]
  status          SetupStatus @default(PROPOSAL)
  prioritySector  String?
  firmSize        String?
  fund            String?
  typeOfFund      String?
  assignee        String?
  year            String?
  companyLogoUrl  String?
  createdAt       DateTime    @default(now())
  updatedAt       DateTime    @updatedAt

  documents ProjectDocument[]

  @@map("setup_projects")
}

// ─── Project Documents ───────────────────────────────────────────────

model ProjectDocument {
  id             String        @id @default(uuid()) @db.Uuid
  projectId      String        @db.Uuid
  phase          DocumentPhase
  templateItemId String?
  fileName       String
  fileUrl        String
  mimeType       String        @default("application/octet-stream")
  fileData       Bytes?
  createdAt      DateTime      @default(now())
  updatedAt      DateTime      @updatedAt

  project SetupProject @relation(fields: [projectId], references: [id], onDelete: Cascade)

  @@map("project_documents")
}

// ─── CEST Projects ───────────────────────────────────────────────────

model CestProject {
  id              String   @id @default(uuid()) @db.Uuid
  code            String   @unique
  projectTitle    String
  location        String?
  beneficiaries   String?
  programFunding  String?
  status          String?
  approvedAmount  Float?
  releasedAmount  Float?
  projectDuration String?
  staffAssigned   String?
  year            String?
  dateOfApproval  String?
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  @@map("cest_projects")
}

// ─── Map Pins ────────────────────────────────────────────────────────

model MapPin {
  id       String     @id @default(uuid()) @db.Uuid
  lat      Float
  lng      Float
  label    String
  district Int
  program  MapProgram
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt

  @@map("map_pins")
}

// ─── Archival Records ────────────────────────────────────────────────

model ArchivalRecord {
  id        String   @id @default(uuid()) @db.Uuid
  userName  String
  title     String
  company   String?
  contact   String?
  year      String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("archival_records")
}

// ─── Calendar Events ────────────────────────────────────────────────

model CalendarEvent {
  id              String   @id @default(uuid()) @db.Uuid
  title           String
  date            String
  location        String
  bookedBy        String?
  bookedService   String?
  bookedPersonnel String?
  priority        String   @default("Normal")
  staffInvolved   String?
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  @@map("calendar_events")
}

// ─── Address Hierarchy ───────────────────────────────────────────────

model Province {
  id             String         @id @default(uuid()) @db.Uuid
  name           String         @unique
  createdAt      DateTime       @default(now())
  updatedAt      DateTime       @updatedAt
  municipalities Municipality[]

  @@map("provinces")
}

model Municipality {
  id         String     @id @default(uuid()) @db.Uuid
  name       String
  provinceId String     @db.Uuid
  createdAt  DateTime   @default(now())
  updatedAt  DateTime   @updatedAt
  province   Province   @relation(fields: [provinceId], references: [id], onDelete: Cascade)
  barangays  Barangay[]

  @@unique([name, provinceId])
  @@map("municipalities")
}

model Barangay {
  id             String       @id @default(uuid()) @db.Uuid
  name           String
  municipalityId String       @db.Uuid
  createdAt      DateTime     @default(now())
  updatedAt      DateTime     @updatedAt
  municipality   Municipality @relation(fields: [municipalityId], references: [id], onDelete: Cascade)

  @@unique([name, municipalityId])
  @@map("barangays")
}
